---
import logo from '../assets/logo.png';
import profileImg from '../assets/cassogo-profile.jpg';
import { Icon } from 'astro-icon/components';
---

<header class="relative z-[50] text-gray-100">
  <div class="mx-auto flex w-full max-w-[1800px] items-center justify-between px-4 py-3">
    <div class="flex items-center gap-6 lg:gap-[120px]">
      <a href="/" aria-label="DOGGO Home">
        <img src={logo.src} alt="DOGGO" class="w-[120px] cursor-pointer" />
      </a>

      <nav id="desktop-menu" class="hidden items-center text-base text-gray-100 md:flex">
        <ul class="flex items-center gap-6">
          <li><a href="#" class="transition hover:text-white">Home</a></li>
          <li><a href="#" class="transition hover:text-white">Tv Shows</a></li>
          <li><a href="#" class="transition hover:text-white">Movies</a></li>
          <li><a href="#" class="transition hover:text-white">My List</a></li>

          <li class="relative">
            <button
              id="categories-button"
              aria-haspopup="menu"
              aria-expanded="false"
              aria-controls="categories-menu"
              type="button"
              class="inline-flex cursor-pointer items-center gap-2 px-2 py-1 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400"
            >
              Categories
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>

            <ul
              id="categories-menu"
              role="menu"
              class="absolute top-full left-0 mt-2 hidden w-[240px] rounded-xl bg-[#1f1f1f]/65 p-2 text-gray-100 shadow-xl ring-1 ring-black/40 backdrop-blur-sm"
            >
              <li role="none">
                <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
                  <Icon name="material-symbols:whatshot" width="16" height="16" class="flex-shrink-0" />
                  <span>New &amp; Popular</span>
                </a>
              </li>
              <li role="none">
                <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
                  <Icon name="material-symbols:theater-comedy" width="16" height="16" class="flex-shrink-0" />
                  <span>Comedy</span>
                </a>
              </li>
              <li role="none">
                <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
                  <Icon name="material-symbols:skull" width="16" height="16" class="flex-shrink-0" />
                  <span>Horror</span>
                </a>
              </li>
              <li role="none">
                <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
                  <Icon name="material-symbols:movie" width="16" height="16" class="flex-shrink-0" />
                  <span>Documentaries</span>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>

    <div class="flex items-center gap-1 md:gap-3">
      <button
        class="inline-flex cursor-pointer items-center gap-3 rounded-full p-2 text-gray-100 hover:bg-white/5 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400"
        aria-label="Search"
        type="button"
      >
        <Icon name="material-symbols:search-rounded" width="20" height="20" />
      </button>

      <button
        class="inline-flex cursor-pointer items-center gap-3 rounded-full p-2 text-gray-100 hover:bg-white/5 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400"
        aria-label="Notifications"
        type="button"
      >
        <Icon name="material-symbols:notifications-active" width="20" height="20" class="flex cursor-pointer" />
      </button>

      <div class="relative">
        <button
          id="user-button"
          aria-haspopup="menu"
          aria-expanded="false"
          aria-controls="user-menu"
          class="relative flex items-center gap-2 rounded px-2 py-1 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400"
          type="button"
        >
          <img src={profileImg.src} alt="Profile" class="h-8 w-8 cursor-pointer object-cover" />
        </button>

        <ul
          id="user-menu"
          role="menu"
          class="absolute top-full right-0 z-[45] mt-2 hidden w-[220px] rounded-xl bg-[#1f1f1f]/65 p-2 text-gray-100 shadow-xl ring-1 ring-black/40 backdrop-blur-sm"
        >
          <li role="none">
            <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
              <Icon name="material-symbols:person" width="16" height="16" class="flex-shrink-0" />
              <span>Profile</span>
            </a>
          </li>
          <li role="none">
            <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
              <Icon name="material-symbols:settings" width="16" height="16" class="flex-shrink-0" />
              <span>Settings</span>
            </a>
          </li>
          <li role="none">
            <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
              <Icon name="material-symbols:credit-card" width="16" height="16" class="flex-shrink-0" />
              <span>Billing</span>
            </a>
          </li>
          <li role="none">
            <a role="menuitem" href="#" class="flex items-center gap-3 rounded px-3 py-2 hover:bg-white/5">
              <Icon name="material-symbols:logout" width="16" height="16" class="flex-shrink-0" />
              <span>Sign out</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="relative md:hidden">
    <nav aria-label="Primary mobile" class="scrollbar-hide text-md flex gap-4 overflow-x-auto px-4 py-3 font-medium text-gray-100">
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Home</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Tv Shows</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Movies</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">My List</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">New &amp; Popular</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Anime</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Documentaries</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Horror</a>
      <a href="#" class="shrink-0 p-1 transition hover:text-white">Comedy</a>
    </nav>

    <div class="pointer-events-none absolute top-0 left-0 h-full w-10 bg-gradient-to-r from-[#141414]/20 to-transparent"></div>
    <div class="pointer-events-none absolute top-0 right-0 h-full w-10 bg-gradient-to-l from-[#141414]/20 to-transparent"></div>
  </div>
</header>

<script type="module">
  const pairs = [
    ['categories-button', 'categories-menu'],
    ['user-button', 'user-menu'],
  ];

  const buttons = [];
  const menus = [];

  for (const [buttonId, menuId] of pairs) {
    const button = document.getElementById(buttonId);
    const menu = document.getElementById(menuId);
    if (!button || !menu) continue;

    buttons.push(button);
    menus.push(menu);
    menu.classList.add('hidden');
    button.setAttribute('aria-expanded', 'false');

    button.addEventListener('click', (e) => {
      e.stopPropagation();
      const isOpen = !menu.classList.contains('hidden');

      menus.forEach((m) => m.classList.add('hidden'));
      buttons.forEach((b) => b.setAttribute('aria-expanded', 'false'));

      if (!isOpen) {
        menu.classList.remove('hidden');
        button.setAttribute('aria-expanded', 'true');
      }
    });
  }

  document.addEventListener('click', (e) => {
    const insideMenu = menus.some((m) => m.contains(e.target));
    const onButton = buttons.some((b) => b.contains(e.target));
    if (!insideMenu && !onButton) {
      menus.forEach((m) => m.classList.add('hidden'));
      buttons.forEach((b) => b.setAttribute('aria-expanded', 'false'));
    }
  });
</script>

<style>
  header a {
    letter-spacing: 0.2px;
  }
  header nav a {
    padding-left: 6px;
    padding-right: 6px;
  }

  #categories-menu,
  #user-menu {
    box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6);
    -webkit-backdrop-filter: blur(6px);
    backdrop-filter: blur(6px);
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
